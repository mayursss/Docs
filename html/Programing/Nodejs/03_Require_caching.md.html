<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>03_Require_caching</title>
      <link rel="stylesheet" href="../../styles.css">
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="require-caching"><code>require()</code> Caching</h1>
<p><code>require()</code> caches the results based on the filename and path. Any code outside of the module.exports assignment will be run just once during the process execution. For example, the following code is a module named <code>utility.js</code> and it has some code outside of module.exports:</p>
<pre class="editor-colors lang-js"><div class="line"><span class="syntax--source syntax--js"><span class="syntax--entity syntax--name syntax--type syntax--object syntax--console syntax--js"><span>console</span></span><span class="syntax--meta syntax--method-call syntax--js"><span class="syntax--meta syntax--delimiter syntax--method syntax--period syntax--js"><span>.</span></span><span class="syntax--support syntax--function syntax--console syntax--js"><span>log</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--string syntax--quoted syntax--single syntax--js"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js"><span>'</span></span><span>This&nbsp;will&nbsp;be&nbsp;printed&nbsp;just&nbsp;once</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--js"><span>'</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--support syntax--variable syntax--js"><span>module</span></span><span class="syntax--meta syntax--function syntax--js"><span class="syntax--meta syntax--delimiter syntax--method syntax--period syntax--js"><span>.</span></span><span class="syntax--entity syntax--name syntax--function syntax--js"><span>exports</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--storage syntax--type syntax--function syntax--js"><span>function</span></span><span class="syntax--meta syntax--parameters syntax--js"><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--variable syntax--parameter syntax--function syntax--js"><span>numbersToSum</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--function syntax--body syntax--begin syntax--bracket syntax--curly syntax--js"><span>{</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;sum&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>0</span></span><span class="syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js"><span>,</span></span><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>0</span></span><span class="syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js"><span>,</span></span><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--variable syntax--other syntax--object syntax--js"><span>numbersToSum</span></span><span class="syntax--meta syntax--delimiter syntax--property syntax--period syntax--js"><span>.</span></span><span class="syntax--support syntax--variable syntax--property syntax--js"><span>length</span></span><span class="syntax--punctuation syntax--terminator syntax--statement syntax--js"><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--js"><span>while</span></span><span>&nbsp;</span><span class="syntax--meta syntax--brace syntax--round syntax--js"><span>(</span></span><span>i&nbsp;</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--js"><span>&lt;</span></span><span>&nbsp;l</span><span class="syntax--meta syntax--brace syntax--round syntax--js"><span>)</span></span><span>&nbsp;</span><span class="syntax--meta syntax--brace syntax--curly syntax--js"><span>{</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--compound syntax--js"><span>+=</span></span><span>&nbsp;numbersToSum</span><span class="syntax--meta syntax--brace syntax--square syntax--js"><span>[</span></span><span>i</span><span class="syntax--keyword syntax--operator syntax--increment syntax--js"><span>++</span></span><span class="syntax--meta syntax--brace syntax--square syntax--js"><span>]</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--brace syntax--curly syntax--js"><span>}</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--keyword syntax--control syntax--js"><span>return</span></span><span>&nbsp;sum</span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--punctuation syntax--definition syntax--function syntax--body syntax--end syntax--bracket syntax--curly syntax--js"><span>}</span></span></span></div></pre>
<p>The <code>account-service.js</code> file uses our <code>utility.js</code> module:</p>
<pre class="editor-colors lang-js"><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--const syntax--js"><span>const</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--js"><span>sum</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--js"><span class="syntax--support syntax--function syntax--js"><span>require</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--string syntax--quoted syntax--single syntax--js"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js"><span>'</span></span><span>./utility.js</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--js"><span>'</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;checkingAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>200</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;savingsAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>1000</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;retirementAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>20000</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;totalBalance</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span class="syntax--meta syntax--function-call syntax--js"><span class="syntax--entity syntax--name syntax--function syntax--js"><span>sum</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--meta syntax--brace syntax--square syntax--js"><span>[</span></span><span>checkingAccountBalance</span><span class="syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js"><span>,</span></span><span>&nbsp;savingsAccountBalance</span><span class="syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js"><span>,</span></span><span>&nbsp;retirementAccountBalance</span><span class="syntax--meta syntax--brace syntax--square syntax--js"><span>]</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--entity syntax--name syntax--type syntax--object syntax--console syntax--js"><span>console</span></span><span class="syntax--meta syntax--method-call syntax--js"><span class="syntax--meta syntax--delimiter syntax--method syntax--period syntax--js"><span>.</span></span><span class="syntax--support syntax--function syntax--console syntax--js"><span>log</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span>totalBalance</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div></pre>
<p>This is <code>app.js</code> which imports two files. AYou can also use <code>require()</code> to run code without assigning the result to anything (line 2).</p>
<pre class="editor-colors lang-js"><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--const syntax--js"><span>const</span></span><span>&nbsp;</span><span class="syntax--constant syntax--other syntax--js"><span>sum</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--meta syntax--function-call syntax--js"><span class="syntax--support syntax--function syntax--js"><span>require</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--string syntax--quoted syntax--single syntax--js"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js"><span>'</span></span><span>./utility.js</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--js"><span>'</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--meta syntax--function-call syntax--js"><span class="syntax--support syntax--function syntax--js"><span>require</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--string syntax--quoted syntax--single syntax--js"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--js"><span>'</span></span><span>./account-service.js</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--js"><span>'</span></span></span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;checkingAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>200</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;savingsAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>1000</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;retirementAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>20000</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span>retirementAccountBalance&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span>&nbsp;</span><span class="syntax--constant syntax--numeric syntax--decimal syntax--js"><span>40000</span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span>&nbsp;</span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--storage syntax--type syntax--var syntax--js"><span>let</span></span><span>&nbsp;totalBalance</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--js"><span>=</span></span><span class="syntax--meta syntax--function-call syntax--js"><span class="syntax--entity syntax--name syntax--function syntax--js"><span>sum</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span class="syntax--meta syntax--brace syntax--square syntax--js"><span>[</span></span><span>checkingAccountBalance</span><span class="syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js"><span>,</span></span><span>&nbsp;savingsAccountBalance</span><span class="syntax--meta syntax--delimiter syntax--object syntax--comma syntax--js"><span>,</span></span><span>&nbsp;retirementAccountBalance</span><span class="syntax--meta syntax--brace syntax--square syntax--js"><span>]</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div><div class="line"><span class="syntax--source syntax--js"><span class="syntax--entity syntax--name syntax--type syntax--object syntax--console syntax--js"><span>console</span></span><span class="syntax--meta syntax--method-call syntax--js"><span class="syntax--meta syntax--delimiter syntax--method syntax--period syntax--js"><span>.</span></span><span class="syntax--support syntax--function syntax--console syntax--js"><span>log</span></span><span class="syntax--meta syntax--arguments syntax--js"><span class="syntax--punctuation syntax--definition syntax--arguments syntax--begin syntax--bracket syntax--round syntax--js"><span>(</span></span><span>totalBalance</span><span class="syntax--punctuation syntax--definition syntax--arguments syntax--end syntax--bracket syntax--round syntax--js"><span>)</span></span></span></span></span></div></pre>
<p>In <code>app.js</code> when you import the module <code>utility.js</code> two or more times (directly and indirectly via <code>account-service.js</code>), the code in <code>utility.js</code> which prints This will be printed just once (it's outside the module.exports) will be run just once despite the fact that the function module.exports (which we exported) is invoked twice: once in <code>account-service.js</code> and the second time in <code>app.js</code>.</p>
<p>Therefore, running <code>app.js</code> will result in its balance being printed twice, one time in account-service and another time in <code>app.js</code>, but the This will be printed just once console log only appears once:</p>
<p>This will be printed just once
21200
41200</p>
<p>Why did the code outside module.exports run just once even though we imported the <code>utility.js</code> module twice (once directly and one indirectly via <code>account-service.js</code>)?</p>
<p><strong>The reason is because <code>Node.js</code> will cache imports</strong>. The second time you <code>require()</code> the same file or a module, it's not running the code. The results of the module are already there for you to use.</p>
<p>Just keep this behavior in mind and as a general rule, have all the logic exported in <code>module.exports</code> to avoid any unwanted behavior or conflicts.</p></body>
</html>
