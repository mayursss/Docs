<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>Manage_vSphere_PowerCLI</title>
      <link rel="stylesheet" href="styles.css">
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="sample-scripts-for-managing-vsphere-with-vmware-powercli">Sample Scripts for Managing vSphere with VMware PowerCLI</h1>
<h2 id="1-connect-to-a-vcenter-serversystem">1. Connect to a vCenter ServerSystem</h2>
<ul>
<li>To run PowerCLI cmdlets on vSphere and perform administration or monitoring tasks, you must establish a connection to an ESXi host or a vCenter Server system.</li>
<li>You can have more than one connection to the same server. For more information, see Managing Default Server Connections.</li>
<li>If your login credentials contain non-alphanumeric characters, you might need to escape them.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Connect-VIServer</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Server&nbsp;esx3.example.com&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Protocol&nbsp;http&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>User&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--powershell"><span>'</span><span>MyAdministratorUser</span><span>'</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Password&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--powershell"><span>'</span><span>MyPassword</span><span>'</span></span></span></div></pre>
<h2 id="2-manage-virtual-machines-on-vsphere">2. Manage Virtual Machines on vSphere</h2>
</li>
<li>With PowerCLI, you can automate various administration tasks on virtual machines, for example retrieving information, shutting down and powering off virtual machines.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;View&nbsp;all&nbsp;virtual&nbsp;machines&nbsp;on&nbsp;the&nbsp;target&nbsp;system.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;&nbsp;&nbsp;&nbsp;Save&nbsp;the&nbsp;name&nbsp;and&nbsp;the&nbsp;power&nbsp;state&nbsp;properties&nbsp;of&nbsp;the&nbsp;virtual&nbsp;machines&nbsp;in&nbsp;the&nbsp;ResourcePool&nbsp;resource&nbsp;pool&nbsp;into&nbsp;a&nbsp;file&nbsp;named&nbsp;myVMProperties.txt.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>respool</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-ResourcePool</span></span><span>&nbsp;ResourcePool</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>respool</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Select-Object</span></span><span>&nbsp;Name</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>,</span></span><span>&nbsp;PowerState&nbsp;</span><span class="syntax--keyword syntax--operator syntax--redirection syntax--powershell"><span>&gt;</span></span><span>&nbsp;myVMProperties.txt</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Start&nbsp;the&nbsp;VM&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;VM&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Start-VM</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Get&nbsp;information&nbsp;of&nbsp;the&nbsp;guest&nbsp;OS&nbsp;of&nbsp;the&nbsp;VM&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMGuest</span></span><span>&nbsp;VM&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Format-Custom</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Shut&nbsp;down&nbsp;the&nbsp;OS&nbsp;of&nbsp;the&nbsp;VM&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Stop-VMGuest</span></span><span>&nbsp;VM</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Power&nbsp;off&nbsp;the&nbsp;VM&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Stop-VM</span></span><span>&nbsp;VM</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Move&nbsp;the&nbsp;virtual&nbsp;machine&nbsp;VM&nbsp;from&nbsp;the&nbsp;Host01&nbsp;host&nbsp;to&nbsp;the&nbsp;Host02&nbsp;host.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;Host01&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Move-VM</span></span><span>&nbsp;–Destination&nbsp;Host02</span></span></div></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>If the virtual machine you want to move across hosts is powered on, it must be located on a shared storage registered as a datastore on both the original and the new host.</p>
</blockquote>
</li>
</ul>
<h2 id="3-add-a-standalone-host-to-a-vcenter-server-system">3. Add a Standalone Host to a vCenter Server System</h2>
<ul>
<li>You can add standalone hosts to a vCenter Server system by using the <code>Add-VMHost</code> cmdlet. After adding the hosts, you will be able to manage them through the vCenter Server system.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;View&nbsp;all&nbsp;hosts&nbsp;on&nbsp;the&nbsp;vCenter&nbsp;Server&nbsp;system&nbsp;that&nbsp;you&nbsp;have&nbsp;established&nbsp;a&nbsp;connection&nbsp;with.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMHost</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Add&nbsp;the&nbsp;Host&nbsp;standalone&nbsp;host.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Add-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Host&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>(</span></span><span class="syntax--interpolated syntax--simple syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Datacenter</span></span><span>&nbsp;DC</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>)</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>User&nbsp;root&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Password&nbsp;pass</span></span></div></pre>
<h2 id="4-set-the-license-key-for-a-host-on-vcenter-server">4. Set the License Key for a Host on vCenter Server</h2>
</li>
<li>You can set the license key for a host on a vCenter Server system by using the LicenseKey parameter of the <code>Set-VMHost</code> cmdlet.
Set the host to evaluation mode or provide a valid license key.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Save&nbsp;the&nbsp;Host&nbsp;host&nbsp;object&nbsp;as&nbsp;a&nbsp;variable.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Host</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Set&nbsp;the&nbsp;host&nbsp;to&nbsp;evaluation&nbsp;mode&nbsp;by&nbsp;providing&nbsp;the&nbsp;evaluation&nbsp;key.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Set-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>LicenseKey&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>00000</span></span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>00000</span></span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>00000</span></span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>00000</span></span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>00000</span></span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Provide&nbsp;a&nbsp;valid&nbsp;license&nbsp;key</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Set-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>LicenseKey&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>Your_license_key</span><span>"</span></span></span></div></pre>
</li>
</ul>
<h2 id="5-activate-maintenance-mode-for-a-host-on-vcenter-server">5. Activate Maintenance Mode for a Host on vCenter Server</h2>
<ul>
<li>To complete some specific administration tasks, you might need to activate maintenance mode for a host. On vCenter Server, you can activate maintenance mode by using the Set-VMHost cmdlet.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Save&nbsp;the&nbsp;Host&nbsp;host&nbsp;object&nbsp;as&nbsp;a&nbsp;variable.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Host</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Get&nbsp;the&nbsp;cluster&nbsp;to&nbsp;which&nbsp;Host&nbsp;belongs&nbsp;and&nbsp;save&nbsp;the&nbsp;cluster&nbsp;object&nbsp;as&nbsp;a&nbsp;variable.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhostCluster</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Cluster</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Start&nbsp;a&nbsp;task&nbsp;that&nbsp;activates&nbsp;maintenance&nbsp;mode&nbsp;for&nbsp;the&nbsp;"Host"&nbsp;host&nbsp;and&nbsp;save&nbsp;the&nbsp;task&nbsp;object&nbsp;as&nbsp;a&nbsp;variable.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>updateHostTask</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>State&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>Maintenance</span><span>"</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>RunAsync</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Get&nbsp;and&nbsp;apply&nbsp;the&nbsp;recommendations&nbsp;generated&nbsp;by&nbsp;DRS.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-DrsRecommendation</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Cluster&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhostCluster</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--powershell"><span>where</span></span><span>&nbsp;{</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--support syntax--constant syntax--automatic syntax--powershell"><span>_</span></span><span class="syntax--entity syntax--name syntax--function syntax--invocation syntax--powershell"><span>.Reason</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--logical syntax--powershell"><span>-eq</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>Host&nbsp;is&nbsp;entering&nbsp;maintenance&nbsp;mode</span><span>"</span></span><span>}&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Invoke-DrsRecommendation</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Get&nbsp;the&nbsp;task&nbsp;output&nbsp;object&nbsp;and&nbsp;save&nbsp;it&nbsp;as&nbsp;a&nbsp;variable.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>myUpdatedHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Wait-Task</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>updateHostTask</span></span></span></div></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>If the host is not automated or is partially automated and has powered-on virtual machines running on it, you must use the RunAsync parameter and wait until all powered-on virtual machines are relocated or powered off before applying DRS recommendations.</p>
</blockquote>
</li>
</ul>
<h2 id="6-create-vsphere-inventory-objects">6. Create vSphere Inventory Objects</h2>
<ul>
<li>By using PowerCLI cmdlets, you can automate creating different inventory objects on vSphere.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Get&nbsp;the&nbsp;inventory&nbsp;root&nbsp;folder&nbsp;and&nbsp;create&nbsp;a&nbsp;new&nbsp;folder&nbsp;named&nbsp;Folder&nbsp;in&nbsp;it.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>folder</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Folder</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>NoRecursion&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-Folder</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Folder</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;new&nbsp;data&nbsp;center&nbsp;named&nbsp;DC&nbsp;in&nbsp;the&nbsp;Folder&nbsp;folder.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>New-Datacenter</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>folder</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;DC</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;folder&nbsp;named&nbsp;Folder1&nbsp;under&nbsp;DC.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Datacenter</span></span><span>&nbsp;DC&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-Folder</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Folder1</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>folder1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Folder</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Folder1</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;new&nbsp;cluster&nbsp;Cluster1&nbsp;in&nbsp;the&nbsp;Folder1&nbsp;folder.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>New-Cluster</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>folder1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Cluster1&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>DrsEnabled&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>DrsAutomationLevel&nbsp;FullyAutomated</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Distributed&nbsp;Resource&nbsp;Scheduler&nbsp;(DRS)&nbsp;is&nbsp;a&nbsp;feature&nbsp;that&nbsp;provides&nbsp;automatic&nbsp;allocation&nbsp;of&nbsp;cluster&nbsp;resources.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Add&nbsp;a&nbsp;host&nbsp;in&nbsp;the&nbsp;cluster&nbsp;by&nbsp;using&nbsp;the&nbsp;Add-VMHost&nbsp;command,&nbsp;and&nbsp;provide&nbsp;credentials&nbsp;when&nbsp;prompted.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Add-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>10.23</span></span></span><span>.</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>112.345</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>(</span></span><span class="syntax--interpolated syntax--simple syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Cluster</span></span><span>&nbsp;Cluster1</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>)</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;resource&nbsp;pool&nbsp;in&nbsp;the&nbsp;root&nbsp;resource&nbsp;pool&nbsp;of&nbsp;the&nbsp;cluster.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>myClusterRootRP</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Cluster</span></span><span>&nbsp;Cluster1&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-ResourcePool</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Resources</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>New-ResourcePool</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>myClusterRootRP</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;MyRP01&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>CpuExpandableReservation&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--constant syntax--language syntax--powershell"><span>true</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>CpuReservationMhz&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>500</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>CpuSharesLevel&nbsp;high&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>MemExpandableReservation&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--constant syntax--language syntax--powershell"><span>true</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>MemReservationGB&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>1</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>`</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span>&nbsp;&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>MemSharesLevel&nbsp;high</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;virtual&nbsp;machine&nbsp;asynchronously.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmCreationTask</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM2&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>ResourcePool&nbsp;MyRP01&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>DiskGB&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>100</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>MemoryGB&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>2</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>RunAsync</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;The&nbsp;RunAsync&nbsp;parameter&nbsp;indicates&nbsp;that&nbsp;the&nbsp;command&nbsp;runs&nbsp;asynchronously.&nbsp;This&nbsp;means&nbsp;that&nbsp;in&nbsp;contrast&nbsp;to&nbsp;a&nbsp;synchronous</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;operation,&nbsp;you&nbsp;do&nbsp;not&nbsp;have&nbsp;to&nbsp;wait&nbsp;for&nbsp;the&nbsp;process&nbsp;to&nbsp;complete&nbsp;before&nbsp;supplying&nbsp;the&nbsp;next&nbsp;command&nbsp;at&nbsp;the&nbsp;command&nbsp;line.</span></span></span></div></pre>
</li>
</ul>
<h2 id="7-create-virtual-machines-on-vcenter-server-using-an-xml-specification-file">7. Create Virtual Machines on vCenter Server Using an XML Specification File</h2>
<ul>
<li>You can use a specification provided in an XML file to automate the creation of virtual machines on vCenter Server.</li>
<li>The myVM.xml file must be present with the following content:<pre class="editor-colors lang-"><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;CreateVM&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;VM&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;Name&gt;MyVM1&lt;/Name&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;HDDCapacity&gt;100&lt;/HDDCapacity&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;/VM&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;VM&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;Name&gt;MyVM2&lt;/Name&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;HDDCapacity&gt;100&lt;/HDDCapacity&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;/VM&gt;</span></span></div><div class="line"><span class="syntax--text syntax--plain syntax--null-grammar"><span>&lt;/CreateVM&gt;</span></span></div></pre><pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Read&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;myVM.xml&nbsp;file.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--entity syntax--other syntax--attribute-name"><span>[</span><span>x</span><span>m</span><span>l</span><span>]</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>s</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Content</span></span><span>&nbsp;myVM.xml</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;get&nbsp;VM&nbsp;host</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmhost1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMHost</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;Host</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;create&nbsp;the&nbsp;virtual&nbsp;machines.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>s</span></span><span class="syntax--entity syntax--name syntax--function syntax--invocation syntax--powershell"><span>.CreateVM.VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--powershell"><span>foreach</span></span><span>&nbsp;{</span><span class="syntax--support syntax--function syntax--powershell"><span>New-VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vmHost1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--support syntax--constant syntax--automatic syntax--powershell"><span>_</span></span><span class="syntax--entity syntax--name syntax--function syntax--invocation syntax--powershell"><span>.Name</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>DiskGB&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--support syntax--constant syntax--automatic syntax--powershell"><span>_</span></span><span class="syntax--entity syntax--name syntax--function syntax--invocation syntax--powershell"><span>.HDDCapacity</span></span><span>}</span></span></div></pre>
</li>
</ul>
<h2 id="8-manage-virtual-machine-templates-on-vcenter-server">8. Manage Virtual Machine Templates on vCenter Server</h2>
<ul>
<li>You can use PowerCLI to create virtual machines templates and convert them to virtual machines on vCenter Server.</li>
<li>A virtual machine template is a reusable image created from a virtual machine. The template, as a derivative of the source virtual machine, includes virtual hardware components, an installed guest operating system, and software applications.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;template&nbsp;from&nbsp;the&nbsp;VM1&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>New-Template</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VM&nbsp;VM1&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM1Template&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>(</span></span><span class="syntax--interpolated syntax--simple syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Datacenter</span></span><span>&nbsp;DC&nbsp;</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>)</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Convert&nbsp;the&nbsp;VM1Template&nbsp;template&nbsp;for&nbsp;use&nbsp;by&nbsp;a&nbsp;virtual&nbsp;machine&nbsp;named&nbsp;VM3.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Template</span></span><span>&nbsp;VM1Template&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-Template</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>ToVM&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM3</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;template&nbsp;from&nbsp;the&nbsp;VM2&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>New-Template</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VM&nbsp;VM2&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM2Template&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Location&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>(</span></span><span class="syntax--interpolated syntax--simple syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Datacenter</span></span><span>&nbsp;DC&nbsp;</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>)</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Convert&nbsp;the&nbsp;VM2Template&nbsp;template&nbsp;to&nbsp;a&nbsp;virtual&nbsp;machine&nbsp;named&nbsp;VM4.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Template</span></span><span>&nbsp;VM2Template&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-Template</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>ToVM&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM4</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Convert&nbsp;the&nbsp;VM4&nbsp;virtual&nbsp;machine&nbsp;to&nbsp;a&nbsp;template.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Set-VM</span></span><span>&nbsp;–VM&nbsp;VM4&nbsp;–ToTemplate&nbsp;–Name&nbsp;“VM4Template”</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Create&nbsp;a&nbsp;template&nbsp;called&nbsp;VM3Template&nbsp;by&nbsp;cloning&nbsp;VM2Template.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-Template</span></span><span>&nbsp;VM2Template&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-Template</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;VM3Template&nbsp;–VMHost&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>targetVMHost</span></span></span></div></pre>
</li>
</ul>
<h2 id="9-create-and-use-snapshots-on-vcenter-server">9. Create and Use Snapshots on vCenter Server</h2>
<ul>
<li>You can use the Snapshot parameter of Get-VM to take a snapshot of virtual machines and then revert the states of the virtual machines back to the snapshot.</li>
<li>A snapshot captures the memory, disk, and settings state of a virtual machine at a particular moment. When you revert to a snapshot, you return all these items to the state they were in at the time you took that snapshot.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Take&nbsp;a&nbsp;snapshot&nbsp;of&nbsp;all&nbsp;virtual&nbsp;machines&nbsp;in&nbsp;the&nbsp;MyRP01&nbsp;resource&nbsp;pool.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-ResourcePool</span></span><span>&nbsp;MyRP01&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-Snapshot</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;InitialSnapshot</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Revert&nbsp;all&nbsp;virtual&nbsp;machines&nbsp;in&nbsp;the&nbsp;MyRP01&nbsp;resource&nbsp;pool&nbsp;to&nbsp;the&nbsp;InitialSnapshot&nbsp;snapshot.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>VMs</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-ResourcePool</span></span><span>&nbsp;MyRP01&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--control syntax--powershell"><span>foreach</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>(</span></span><span class="syntax--interpolated syntax--simple syntax--source syntax--powershell"><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--powershell"><span>in</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>VMs</span></span><span>&nbsp;</span></span><span class="syntax--keyword syntax--other syntax--powershell"><span>)</span></span><span>&nbsp;{&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-VM</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VM&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm</span></span><span>&nbsp;–Snapshot&nbsp;InitialSnapshot&nbsp;}</span></span></div></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>The Location parameter takes arguments of the VIContainer type, on which Cluster, Datacenter, Folder, ResourcePool, and
VMHost object types are based. Therefore, the Location parameter can use arguments of all these types.</p>
</blockquote>
</li>
</ul>
<h2 id="10-update-the-resource-configuration-settings-of-a-virtual-machine-on-vcenter-server">10. Update the Resource Configuration Settings of a Virtual Machine on vCenter Server</h2>
<ul>
<li>You can use the <code>Set-VMResourceConfiguration</code> cmdlet to modify the resource configuration properties of a virtual machine, including memory, CPU shares, and other settings.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;View&nbsp;the&nbsp;resource&nbsp;configuration&nbsp;for&nbsp;the&nbsp;VM1&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VM&nbsp;VM1</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;View&nbsp;the&nbsp;disk&nbsp;share&nbsp;of&nbsp;the&nbsp;VM1&nbsp;virtual&nbsp;machine.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>VM&nbsp;VM1&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Format-Custom</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Property&nbsp;DiskResourceConfiguration</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Change&nbsp;the&nbsp;memory&nbsp;share&nbsp;of&nbsp;the&nbsp;VM1&nbsp;virtual&nbsp;machine&nbsp;to&nbsp;low.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;VM1&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>MemSharesLevel&nbsp;low</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Change&nbsp;the&nbsp;CPU&nbsp;shares&nbsp;of&nbsp;the&nbsp;VM1&nbsp;virtual&nbsp;machine&nbsp;to&nbsp;high.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;VM1&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>CpuSharesLevel&nbsp;high</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--comment syntax--line syntax--number-sign syntax--powershell"><span>#</span><span>&nbsp;Change&nbsp;the&nbsp;disk&nbsp;share&nbsp;of&nbsp;the&nbsp;VM1&nbsp;virtual&nbsp;machine&nbsp;to&nbsp;100.</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-VM</span></span><span>&nbsp;VM1</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm1disk</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-HardDisk</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm1</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Get-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm1</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>|</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Set-VMResourceConfiguration</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Disk&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>vm1disk</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>DiskSharesLevel&nbsp;custom&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>NumDiskShares&nbsp;</span><span class="syntax--constant syntax--numeric syntax--scientific syntax--powershell"><span class="syntax--support syntax--constant syntax--powershell"><span>100</span></span></span></span></div></pre>
</li>
</ul></body>
</html>
