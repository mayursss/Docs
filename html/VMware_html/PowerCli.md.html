<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>PowerCli</title>
    <link rel="stylesheet" href="styles.css">  
  </head>
  <body class='markdown-preview' data-use-github-style><h3 id="connect-to-a-vcenter-server-system">Connect to a vCenter Server System</h3>
<ul>
<li>Run Connect-VIServer with the server name and valid credentials.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Connect-VIServer</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Server&nbsp;vc3.example.com&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>User&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--powershell"><span>'</span><span>MyAdministratorUser</span><span>'</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Password&nbsp;</span><span class="syntax--string syntax--quoted syntax--single syntax--powershell"><span>'</span><span>MyPassword</span><span>'</span></span></span></div></pre>
</li>
</ul>
<h3 id="create-patch-baselines">Create Patch Baselines</h3>
<ol>
<li>Retrieve all host patches released after 1 Jan 2015 for ESXi products, and create a fixed baseline named Static Baseline, containing the retrieved patches.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>patches</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Patch</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>After&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>1&nbsp;Jan&nbsp;2015</span><span>"</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Product&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>ESXi</span><span>"</span></span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>staticBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-PatchBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Static&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>Static&nbsp;Baseline</span><span>"</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>IncludePatch&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>patches</span></span></span></div></pre>
</li>
<li>Create a critical dynamic baseline named Dynamic Baseline by using a fetch-all query.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>criticalPatchBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>New-PatchBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Dynamic&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>Dynamic&nbsp;Baseline</span><span>"</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>SearchPatchSeverity&nbsp;Critical</span></span></div></pre>
</li>
<li>Create an extension baseline that contains all available extensions.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>extensions</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Get-Patch</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>BundleType&nbsp;Extension</span></span></div><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>New-PatchBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Static&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Name&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--powershell"><span>"</span><span>Extension&nbsp;Baseline</span><span>"</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Extension&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>IncludePatch&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>extensions</span></span></span></div></pre>
</li>
</ol>
<h3 id="attach-and-detach-baselines">Attach and Detach Baselines</h3>
<ol>
<li>Attach the host patch baselines stored in the provided variables to the host named Host.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Add-EntityBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Baseline&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>staticBaseline</span></span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>,</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>criticalPatchBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Entity&nbsp;Host</span></span></div></pre>
</li>
<li>Detach the two baselines from the host.<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Remove-EntityBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Baseline&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>dynamicBaseline</span></span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>,</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>staticBaseline</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Entity&nbsp;Host</span></span></div></pre>
</li>
</ol>
<h3 id="scan-a-virtual-machine">Scan a Virtual Machine</h3>
<ol>
<li><p>Initialize scanning on a virtual machine that is named VM against baselines containing virtual machine hardware upgrades and VMware Tools upgrades.</p>
<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>task</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>=</span></span><span>&nbsp;</span><span class="syntax--support syntax--function syntax--powershell"><span>Test-Compliance</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Entity&nbsp;VM&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>UpdateType&nbsp;VmHardwareUpgrade</span><span class="syntax--keyword syntax--operator syntax--other syntax--powershell"><span>,</span></span><span>&nbsp;VmToolsUpgrade&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>RunAsync</span></span></div></pre>
<p>The command initializes a task on the server, returns a snapshot object of the initial state of the task, and saves it in the <code>$task</code> variable.</p>
</li>
<li><p>View the initial status of the scanning task.
$task</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The task object is not updated with the actual state of the task process running on the server. Even after the task is completed, the $task variable value is running. To view the actual status of the tasks running on the server, use the <code>Get-Task</code> cmdlet.</p>
</blockquote>
</li>
<li><p>(Optional) Run the <code>Wait-Task</code> cmdlet to monitor the process progress and wait for the task to complete before running other commands.</p>
<pre class="editor-colors lang-powershell"><div class="line"><span class="syntax--source syntax--powershell"><span class="syntax--support syntax--function syntax--powershell"><span>Wait-Task</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--powershell"><span>-</span></span><span>Task&nbsp;</span><span class="syntax--keyword syntax--other syntax--powershell"><span>$</span></span><span class="syntax--variable syntax--other syntax--readwrite syntax--powershell"><span>task</span></span></span></div></pre>
</li>
</ol></body>
</html>
